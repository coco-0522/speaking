<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­ä¼šè¯è¯„ä¼°ç³»ç»Ÿ</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #output { margin-top: 20px; padding: 10px; border: 1px solid #ddd; min-height: 50px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>è‹±è¯­ä¼šè¯è¯„ä¼°ç³»ç»Ÿ</h2>
        
        <label for="difficulty">é€‰æ‹©éš¾åº¦ï¼š</label>
        <select id="difficulty">
            <option value="easy">åˆçº§</option>
            <option value="medium">ä¸­çº§</option>
            <option value="hard">é«˜çº§</option>
        </select>
        <button onclick="generateTopic()">ç”Ÿæˆä¸»é¢˜</button>

        <h3>ä¼šè¯ä¸»é¢˜ï¼š</h3>
        <p id="topic">ï¼ˆè¯·ç‚¹å‡»æŒ‰é’®ç”Ÿæˆä¸»é¢˜ï¼‰</p>

        <button onclick="startRecording()">ğŸ¤ å¼€å§‹å½•éŸ³</button>
        <button onclick="stopRecording()">â¹ åœæ­¢å½•éŸ³</button>

        <h3>æ‚¨çš„å›ç­”ï¼š</h3>
        <div id="output">ï¼ˆå½•éŸ³åä¼šæ˜¾ç¤ºæ‚¨çš„å›ç­”ï¼‰</div>

        <button onclick="evaluateSpeech()">è¯„ä¼°</button>
        <h3>è¯„ä¼°ç»“æœï¼š</h3>
        <p id="score">ï¼ˆç‚¹å‡»è¯„ä¼°åæŸ¥çœ‹åˆ†æ•°ï¼‰</p>
    </div>

    <script>
        let recognition;
        let isRecording = false;
        let userResponse = "";

        const topics = {
            easy: ["è‡ªæˆ‘ä»‹ç»", "ä½ çš„å…´è¶£çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ", "ä½ æœ€å–œæ¬¢çš„é£Ÿç‰©æ˜¯ä»€ä¹ˆï¼Ÿ"],
            medium: ["æè¿°ä¸€æ¬¡éš¾å¿˜çš„æ—…è¡Œ", "ä½ å¦‚ä½•åº¦è¿‡å‘¨æœ«ï¼Ÿ", "ä½ æœ€å–œæ¬¢çš„ç”µå½±æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"],
            hard: ["ç§‘æŠ€å¦‚ä½•å½±å“æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Ÿ", "è®¨è®ºç¯å¢ƒä¿æŠ¤çš„é‡è¦æ€§", "äººå·¥æ™ºèƒ½å¯¹æœªæ¥ç¤¾ä¼šçš„å½±å“"]
        };

        function generateTopic() {
            let level = document.getElementById("difficulty").value;
            let topicList = topics[level];
            let randomTopic = topicList[Math.floor(Math.random() * topicList.length)];
            document.getElementById("topic").innerText = randomTopic;
        }

        async function startRecording() {
            if (!('webkitSpeechRecognition' in window)) {
                document.getElementById("output").innerText = "âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨ Google Chrome";
                return;
            }

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    recognition = new webkitSpeechRecognition();
                    recognition.lang = "en-US";
                    recognition.continuous = false;
                    recognition.interimResults = false;

                    recognition.onstart = function () {
                        isRecording = true;
                        document.getElementById("output").innerText = "ğŸ™ æ­£åœ¨å½•éŸ³...";
                    };

                    recognition.onresult = function (event) {
                        userResponse = event.results[0][0].transcript;
                        document.getElementById("output").innerText = userResponse;
                    };

                    recognition.onerror = function (event) {
                        let errorMessage = "âŒ è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•";
                        if (event.error === "not-allowed") {
                            errorMessage = "âš  éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸è®¿é—®éº¦å…‹é£ã€‚";
                        } else if (event.error === "network") {
                            errorMessage = "âš  ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ã€‚";
                        } else if (event.error === "no-speech") {
                            errorMessage = "ğŸ¤ æœªæ£€æµ‹åˆ°è¯­éŸ³ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚";
                        }
                        document.getElementById("output").innerText = errorMessage;
                        userResponse = "";
                    };

                    recognition.start();
                })
                .catch(function(err) {
                    document.getElementById("output").innerText = "âš  æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨éº¦å…‹é£æƒé™ã€‚";
                    console.error("è·å–éº¦å…‹é£æƒé™å¤±è´¥:", err);
                });
        }

        function stopRecording() {
            if (isRecording && recognition) {
                recognition.stop();
                isRecording = false;
            }
        }

        function evaluateSpeech() {
            if (userResponse.trim() === "") {
                document.getElementById("score").innerText = "æœªæ£€æµ‹åˆ°è¯­éŸ³ï¼Œè¯·é‡è¯•ã€‚";
                return;
            }
            let score = Math.floor(Math.random() * 40) + 60;
            document.getElementById("score").innerText = "æ‚¨çš„å¾—åˆ†: " + score + " / 100";
        }
    </script>
</body>
</html>